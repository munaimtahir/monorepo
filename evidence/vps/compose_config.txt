## docker compose config
name: vexel-health
services:
  api:
    build:
      context: /home/munaim/srv/apps/vexel-health
      dockerfile: apps/api/Dockerfile
    depends_on:
      pdf:
        condition: service_started
        required: true
      postgres:
        condition: service_started
        required: true
      redis:
        condition: service_started
        required: true
    environment:
      DATABASE_URL: postgresql://user:password@postgres:5432/vexel
      DEV_ADMIN_DOMAINS: vexel.alshifalab.pk,tenant-a.test
      DEV_ADMIN_EMAIL: admin@vexel.com
      DEV_ADMIN_NAME: Development Admin
      DEV_ADMIN_PASSWORD: Admin@123!
      DEV_ADMIN_ROLE_NAME: ADMIN
      DEV_ADMIN_TENANT_ID: 11111111-1111-4111-8111-111111111111
      DEV_ADMIN_TENANT_NAME: Vexel Development Tenant
      DEV_ADMIN_TENANT_STATUS: active
      DEV_ADMIN_USER_STATUS: active
      DOCUMENTS_LOCAL_DIR: /data/documents
      PDF_SERVICE_URL: http://pdf:8080
      REDIS_URL: redis://redis:6379
      TENANCY_DEV_HEADER_ENABLED: "1"
    networks:
      default: null
    ports:
      - mode: ingress
        host_ip: 127.0.0.1
        target: 3000
        published: "3000"
        protocol: tcp
    restart: unless-stopped
    volumes:
      - type: volume
        source: documents_data
        target: /data/documents
        volume: {}
  pdf:
    build:
      context: /home/munaim/srv/apps/vexel-health/apps/pdf
      dockerfile: Dockerfile
    environment:
      ASPNETCORE_URLS: http://+:8080
    networks:
      default: null
    ports:
      - mode: ingress
        host_ip: 127.0.0.1
        target: 8080
        published: "5000"
        protocol: tcp
    restart: unless-stopped
  postgres:
    environment:
      POSTGRES_DB: vexel
      POSTGRES_PASSWORD: password
      POSTGRES_USER: user
    image: postgres:15-alpine
    networks:
      default: null
    volumes:
      - type: volume
        source: postgres_data
        target: /var/lib/postgresql/data
        volume: {}
  redis:
    image: redis:7-alpine
    networks:
      default: null
  web:
    build:
      context: /home/munaim/srv/apps/vexel-health
      dockerfile: apps/web/Dockerfile
    depends_on:
      api:
        condition: service_started
        required: true
    environment:
      NEXT_PUBLIC_API_URL: /api
      NEXT_PUBLIC_TENANCY_DEV_HEADER_ENABLED: "1"
    networks:
      default: null
    ports:
      - mode: ingress
        host_ip: 127.0.0.1
        target: 3000
        published: "3001"
        protocol: tcp
  worker:
    build:
      context: /home/munaim/srv/apps/vexel-health
      dockerfile: apps/worker/Dockerfile
    depends_on:
      pdf:
        condition: service_started
        required: true
      postgres:
        condition: service_started
        required: true
      redis:
        condition: service_started
        required: true
    environment:
      DATABASE_URL: postgresql://user:password@postgres:5432/vexel
      DOCUMENTS_LOCAL_DIR: /data/documents
      PDF_SERVICE_URL: http://pdf:8080
      REDIS_URL: redis://redis:6379
    networks:
      default: null
    restart: unless-stopped
    volumes:
      - type: volume
        source: documents_data
        target: /data/documents
        volume: {}
networks:
  default:
    name: vexel-health_default
volumes:
  documents_data:
    name: vexel-health_documents_data
  postgres_data:
    name: vexel-health_postgres_data
